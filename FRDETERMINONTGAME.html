<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu des D√©terminants : Ultimate Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Couleurs dynamiques (seront chang√©es par JS) */
            --theme-color: #27ae60; 
            --bg: #ecf0f1;
            --text: #2c3e50;
            --white: #ffffff;
            --wrong: #c0392b;
            --highlight: #e74c3c; /* ÿßŸÑÿ£ÿ≠ŸÖÿ± ŸÑŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ŸáÿØŸÅÿ© */
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Fredoka', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.5s;
        }

        .game-container {
            background: var(--white);
            width: 100%;
            max-width: 700px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
            min-height: 650px;
        }

        /* Top Bar with Return Button */
        .top-bar {
            background: var(--theme-color);
            padding: 10px 20px;
            display: flex;
            align-items: center;
            transition: background 0.5s;
        }

        .btn-return {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.5);
            padding: 8px 15px;
            border-radius: 20px;
            font-family: inherit;
            font-weight: bold;
            cursor: pointer; /* Change le curseur mais ne fait rien */
            font-size: 0.9rem;
            transition: all 0.2s;
            text-decoration: none;
        }

        .btn-return:hover {
            background: rgba(255,255,255,0.4);
            transform: translateY(-2px);
        }

        /* Header */
        .header {
            background: var(--theme-color);
            color: white;
            padding: 10px 20px 20px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.2rem;
            transition: background 0.5s;
        }

        .level-badge {
            background: rgba(0,0,0,0.2);
            padding: 5px 15px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .progress-container {
            width: 100%;
            background: #bdc3c7;
            height: 10px;
        }
        .progress-fill {
            height: 100%;
            background: #f1c40f; /* Jaune pour le contraste */
            width: 0%;
            transition: width 0.4s ease;
        }

        /* Question Area */
        .question-area {
            padding: 30px;
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .question-type {
            color: #7f8c8d;
            text-transform: uppercase;
            font-size: 0.9rem;
            margin-bottom: 20px;
            font-weight: 800;
            letter-spacing: 1px;
            border-bottom: 2px solid #bdc3c7;
            display: inline-block;
            padding-bottom: 5px;
        }

        .question-text {
            font-size: 1.6rem;
            margin-bottom: 40px;
            font-weight: 600;
            line-height: 1.5;
        }

        /* Le mot rouge (Cible) */
        .red-word {
            color: var(--highlight);
            font-weight: 800;
            text-decoration: underline;
            padding: 0 5px;
            font-size: 1.1em; /* Un peu plus grand */
        }

        /* Options */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .options-grid { grid-template-columns: 1fr; }
            .question-text { font-size: 1.3rem; }
        }

        .btn-option {
            background: white;
            border: 3px solid #dfe6e9;
            padding: 15px;
            border-radius: 15px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            color: var(--text);
            font-weight: 600;
        }

        .btn-option:hover {
            border-color: var(--theme-color);
            background: #f7f9fa;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        /* Popups */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.98);
            z-index: 50;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s;
            padding: 20px;
        }

        .overlay.active { visibility: visible; opacity: 1; }

        .big-icon { font-size: 4rem; margin-bottom: 15px; animation: pop 0.4s; }
        .big-title { font-size: 2rem; font-weight: 800; margin-bottom: 15px; }
        .big-msg { font-size: 1.2rem; color: #555; margin-bottom: 30px; font-family: 'Cairo', sans-serif; }

        .btn-next {
            background: var(--theme-color);
            color: white;
            padding: 15px 50px;
            border: none;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.2s, background 0.5s;
        }
        .btn-next:hover { transform: scale(1.05); }
        .btn-retry { background: var(--wrong); }

        .correct-txt { color: #27ae60; }
        .wrong-txt { color: var(--wrong); }

        @keyframes pop {
            0% { transform: scale(0); }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

<div class="game-container">
    <div class="top-bar">
        <button class="btn-return" onclick="window.location.href='FRDETERMINONTCOURE.html'">‚¨Ö Retour √† la le√ßon</button>
    </div>

    <div class="header">
        <span id="score-display">Score: 0</span>
        <span class="level-badge" id="level-display">Niveau 1</span>
    </div>
    <div class="progress-container"><div class="progress-fill" id="progress"></div></div>

    <div class="question-area">
        <div class="question-type" id="q-type">Chargement...</div>
        <div class="question-text" id="q-text"></div>
        <div class="options-grid" id="options-container"></div>
    </div>

    <div class="overlay" id="feedback-overlay">
        <div class="big-icon" id="fb-icon"></div>
        <div class="big-title" id="fb-title"></div>
        <p class="big-msg" id="fb-msg"></p>
        <button class="btn-next" onclick="nextQuestion()">Suivant</button>
    </div>

    <div class="overlay" id="level-overlay">
        <div class="big-icon" id="lvl-icon">üèÜ</div>
        <div class="big-title" id="lvl-title"></div>
        <p class="big-msg" id="lvl-msg"></p>
        <button class="btn-next" id="lvl-btn"></button>
    </div>
</div>

<script>
    /* ================= BANQUE DE QUESTIONS (100+) ================= */
    /* Diff 1: Facile (Niv 1-3)
       Diff 2: Moyen (Niv 4-6)
       Diff 3: Difficile (Niv 7-9)
       Diff 4: EXTR√äME (Niv 10)
    */

    const questionsDB = [
        // --- NIVEAU FACILE (Sample) ---
        { diff: 1, type: "QCM", text: "Je mange <span class='red-word'>___</span> pomme.", options: ["un", "une", "des", "du"], answer: "une", reason: "Pomme est f√©minin." },
        { diff: 1, type: "QCM", text: "Il a <span class='red-word'>___</span> stylo.", options: ["un", "une", "des", "la"], answer: "un", reason: "Stylo est masculin." },
        { diff: 1, type: "ID", text: "Nature de : <span class='red-word'>La</span> table.", options: ["Art D√©fini", "Art Ind√©fini", "Pronom"], answer: "Art D√©fini", reason: "D√©signe une table pr√©cise." },
        { diff: 1, type: "QCM", text: "Regarde <span class='red-word'>___</span> chat.", options: ["le", "la", "les", "une"], answer: "le", reason: "Chat est masculin." },
        { diff: 1, type: "VF", text: "On dit <span class='red-word'>Une</span> homme.", answer: "Faux", reason: "Homme est masculin -> Un homme." },
        { diff: 1, type: "QCM", text: "<span class='red-word'>___</span> √©cole.", options: ["Le", "La", "L'", "Les"], answer: "L'", reason: "Devant voyelle." },
        { diff: 1, type: "QCM", text: "J'aime <span class='red-word'>___</span> vacances.", options: ["le", "la", "l'", "les"], answer: "les", reason: "Vacances est pluriel." },
        { diff: 1, type: "ID", text: "Nature de : <span class='red-word'>Un</span> chien.", options: ["Art Ind√©fini", "Art D√©fini", "Pronom"], answer: "Art Ind√©fini", reason: "Un chien quelconque." },
        { diff: 1, type: "QCM", text: "Tu as <span class='red-word'>___</span> gommes ?", options: ["un", "une", "des", "le"], answer: "des", reason: "Pluriel." },
        { diff: 1, type: "QCM", text: "Voici <span class='red-word'>___</span> maison.", options: ["le", "la", "les", "un"], answer: "la", reason: "Maison est f√©minin." },

        // --- NIVEAU MOYEN (Sample) ---
        { diff: 2, type: "QCM", text: "C'est <span class='red-word'>___</span> amie.", options: ["ma", "mon", "mes", "sa"], answer: "mon", reason: "Exception: Mon devant f√©minin + voyelle." },
        { diff: 2, type: "QCM", text: "Il a perdu <span class='red-word'>___</span> cl√©s.", options: ["son", "sa", "ses", "leur"], answer: "ses", reason: "Pluriel (Ses cl√©s √† lui)." },
        { diff: 2, type: "ID", text: "Nature de : <span class='red-word'>Ce</span> gar√ßon.", options: ["Adj D√©monstratif", "Adj Possessif", "Pronom"], answer: "Adj D√©monstratif", reason: "Sert √† montrer." },
        { diff: 2, type: "QCM", text: "Je bois <span class='red-word'>___</span> caf√©.", options: ["du", "de la", "des", "le"], answer: "du", reason: "Partitif masculin." },
        { diff: 2, type: "VF", text: "Le pluriel de <span class='red-word'>Notre</span> est 'Notres'.", answer: "Faux", reason: "C'est 'Nos'." },
        { diff: 2, type: "QCM", text: "<span class='red-word'>___</span> homme est gentil.", options: ["Ce", "Cet", "Cette", "Ces"], answer: "Cet", reason: "Masc devant H muet." },
        { diff: 2, type: "ID", text: "Nature de : <span class='red-word'>Mon</span> p√®re.", options: ["Adj Possessif", "Art D√©fini", "Pronom"], answer: "Adj Possessif", reason: "Indique la possession." },
        { diff: 2, type: "QCM", text: "Nous aimons <span class='red-word'>___</span> professeur.", options: ["notre", "nos", "votre", "leur"], answer: "notre", reason: "Singulier poss√©d√© par Nous." },
        { diff: 2, type: "QCM", text: "Elles parlent √† <span class='red-word'>___</span> parents.", options: ["leur", "leurs", "ses", "sa"], answer: "leurs", reason: "Pluriel poss√©d√© par Elles." },
        { diff: 2, type: "ID", text: "Nature de : Je veux <span class='red-word'>du</span> pain.", options: ["Art Partitif", "Art Contract√©", "Art D√©fini"], answer: "Art Partitif", reason: "Quantit√© ind√©nombrable." },

        // --- NIVEAU DIFFICILE (Sample) ---
        { diff: 3, type: "QCM", text: "C'est ton stylo ? Oui, c'est <span class='red-word'>___</span>.", options: ["le mien", "la mienne", "le tien", "mon"], answer: "le mien", reason: "Pronom rempla√ßant Stylo (Masc)." },
        { diff: 3, type: "QCM", text: "Je reviens <span class='red-word'>___</span> march√©.", options: ["de le", "du", "des", "de la"], answer: "du", reason: "Contract√© (De + Le)." },
        { diff: 3, type: "QCM", text: "Je parle <span class='red-word'>___</span> √©l√®ves.", options: ["√† les", "aux", "au", "des"], answer: "aux", reason: "Contract√© (√Ä + Les)." },
        { diff: 3, type: "VF", text: "Dans 'La voiture <span class='red-word'>du</span> voisin', Du est partitif.", answer: "Faux", reason: "C'est un contract√© (De+Le). On ne dit pas 'un peu de voisin'." },
        { diff: 3, type: "QCM", text: "Ces chaussures sont √† elles. Ce sont <span class='red-word'>___</span>.", options: ["les leurs", "la leur", "le leur", "les siennes"], answer: "les leurs", reason: "Pluriel (chaussures) + Elles." },
        { diff: 3, type: "QCM", text: "Je vais <span class='red-word'>___</span> toilettes.", options: ["au", "aux", "√† la", "des"], answer: "aux", reason: "Toilettes est toujours pluriel." },
        { diff: 3, type: "ID", text: "Nature de : La queue <span class='red-word'>du</span> chat.", options: ["Art Contract√©", "Art Partitif", "Art D√©fini"], answer: "Art Contract√©", reason: "De + Le (Appartenance)." },
        { diff: 3, type: "QCM", text: "Il ne faut pas parler <span class='red-word'>___</span> inconnus.", options: ["aux", "des", "les", "√† les"], answer: "aux", reason: "Parler √Ä + Les." },
        { diff: 3, type: "ID", text: "Nature de : J'ai achet√© <span class='red-word'>des</span> fleurs.", options: ["Art Ind√©fini", "Art Contract√©", "Art Partitif"], answer: "Art Ind√©fini", reason: "Pluriel de Une fleur." },
        { diff: 3, type: "QCM", text: "Cette place est √† moi, c'est <span class='red-word'>___</span>.", options: ["la mienne", "le mien", "mon", "ma"], answer: "la mienne", reason: "Place (Fem) -> La mienne." },

        // --- NIVEAU 10 (EXTR√äME / BOSS) - 40 Questions ---
        { diff: 4, type: "QCM", text: "J'ai bien <span class='red-word'>___</span> soucis.", options: ["des", "de", "du", "les"], answer: "des", reason: "Locution 'Bien des' est toujours suivie de 'des'." },
        { diff: 4, type: "QCM", text: "Je n'ai pas <span class='red-word'>___</span> argent.", options: ["d'", "de l'", "du", "un"], answer: "d'", reason: "N√©gation absolue (Pas de/d')." },
        { diff: 4, type: "QCM", text: "Ce sont de <span class='red-word'>___</span> beaux enfants.", options: ["des", "de", "les", "du"], answer: "de", reason: "Devant un adjectif pluriel (beaux), 'des' devient souvent 'de'." },
        { diff: 4, type: "VF", text: "On dit : <span class='red-word'>De</span> bons amis.", answer: "Vrai", reason: "Des -> De devant adj pluriel." },
        { diff: 4, type: "ID", text: "Nature de : <span class='red-word'>Chaque</span> jour.", options: ["Adj Ind√©fini", "Pronom Ind√©fini", "Art Ind√©fini"], answer: "Adj Ind√©fini", reason: "Accompagne le nom 'jour'." },
        { diff: 4, type: "ID", text: "Nature de : <span class='red-word'>Chacun</span> pense √† soi.", options: ["Pronom Ind√©fini", "Adj Ind√©fini", "Nom"], answer: "Pronom Ind√©fini", reason: "Remplace le nom." },
        { diff: 4, type: "QCM", text: "Toutes les <span class='red-word'>___</span> gens.", options: ["vieux", "vieilles", "vieil", "vielle"], answer: "vieilles", reason: "Gens : F√©minin si l'adjectif est AVANT." },
        { diff: 4, type: "QCM", text: "Ce sont des gens <span class='red-word'>___</span>.", options: ["heureux", "heureuses", "heureuse", "heureu"], answer: "heureux", reason: "Gens : Masculin si l'adjectif est APR√àS." },
        { diff: 4, type: "QCM", text: "C'est <span class='red-word'>___</span> de mes amis.", options: ["un", "l'un", "une", "le"], answer: "un", reason: "Un de mes amis (Partitif d'un groupe)." },
        { diff: 4, type: "QCM", text: "Elle est <span class='red-word'>___</span> contente.", options: ["tout", "toute", "toutes", "touts"], answer: "toute", reason: "Tout (Adverbe) s'accorde devant adj f√©m commen√ßant par consonne." },
        { diff: 4, type: "QCM", text: "Elle est <span class='red-word'>___</span> √©mue.", options: ["tout", "toute", "toutes", "touts"], answer: "tout", reason: "Tout (Adverbe) reste invariable devant voyelle." },
        { diff: 4, type: "VF", text: "On dit : 'La <span class='red-word'>Saint</span>-Valentin'.", answer: "Vrai", reason: "Saint prend une majuscule et un trait d'union dans les f√™tes." },
        { diff: 4, type: "QCM", text: "Je cherche le livre <span class='red-word'>___</span> tu parles.", options: ["dont", "que", "lequel", "duquel"], answer: "dont", reason: "Parler DE quelque chose -> Dont." },
        { diff: 4, type: "QCM", text: "La chaise sur <span class='red-word'>___</span> je suis assis.", options: ["laquelle", "lequel", "la quelle", "qui"], answer: "laquelle", reason: "Accord avec Chaise (Fem)." },
        { diff: 4, type: "ID", text: "Nature de : <span class='red-word'>Quelque</span> chose.", options: ["Adj Ind√©fini", "Adverbe", "Pronom"], answer: "Adj Ind√©fini", reason: "Signifie 'Un certain'." },
        { diff: 4, type: "QCM", text: "J'ai vu <span class='red-word'>___</span> 200 personnes.", options: ["quelque", "quelques", "quelsque", "quel que"], answer: "quelque", reason: "Quelque (Adverbe = Environ) est invariable devant un nombre." },
        { diff: 4, type: "VF", text: "<span class='red-word'>Maintes</span> fois signifie 'plusieurs fois'.", answer: "Vrai", reason: "Adj ind√©fini pluriel soutenu." },
        { diff: 4, type: "QCM", text: "Sans <span class='red-word'>___</span> doute.", options: ["aucun", "aucune", "nul", "pas de"], answer: "aucun", reason: "Doute est masculin." },
        { diff: 4, type: "QCM", text: "Je ne parle √† <span class='red-word'>___</span>.", options: ["personne", "aucun", "rien", "nul"], answer: "personne", reason: "N√©gation pour les humains." },
        { diff: 4, type: "ID", text: "Nature de : <span class='red-word'>Plusieurs</span> √©l√®ves.", options: ["Adj Ind√©fini", "Pronom", "Nom"], answer: "Adj Ind√©fini", reason: "Invariable, indique le nombre." },
        { diff: 4, type: "QCM", text: "Il a v√©cu de <span class='red-word'>___</span> amours.", options: ["fous", "folles", "folle", "fou"], answer: "folles", reason: "Amour est masculin au singulier, mais F√âMININ au pluriel (litt√©raire)." },
        { diff: 4, type: "QCM", text: "Les <span class='red-word'>___</span> et les autres.", options: ["uns", "un", "unes", "une"], answer: "uns", reason: "Expression : Les uns et les autres." },
        { diff: 4, type: "QCM", text: "<span class='red-word'>___</span> soit votre choix.", options: ["Quel que", "Quelle que", "Quels que", "Quelque"], answer: "Quel que", reason: "Quel que s'√©crit en deux mots devant '√™tre' et s'accorde avec le sujet (Choix = Masc Sing)." },
        { diff: 4, type: "QCM", text: "<span class='red-word'>___</span> soient vos raisons.", options: ["Quelles que", "Quels que", "Quel que", "Quelle que"], answer: "Quelles que", reason: "Accord avec Raisons (Fem Plur)." },
        { diff: 4, type: "VF", text: "<span class='red-word'>M√™me</span> les enfants ont jou√©.", answer: "Vrai", reason: "M√™me (Adverbe = aussi) est invariable." },
        { diff: 4, type: "QCM", text: "Ce sont les enfants <span class='red-word'>___</span>.", options: ["m√™mes", "m√™me", "m√®me", "m√®mes"], answer: "m√™mes", reason: "M√™me (Adjectif = eux-m√™mes) s'accorde." },
        { diff: 4, type: "QCM", text: "Il a mang√© <span class='red-word'>___</span> pain.", options: ["tout le", "tous le", "toute la", "tout"], answer: "tout le", reason: "Tout le (la totalit√©)." },
        { diff: 4, type: "QCM", text: "<span class='red-word'>___</span> hommes sont mortels.", options: ["Tous les", "Tout les", "Touts les", "Toute les"], answer: "Tous les", reason: "Tous (Pluriel) + Les." },
        { diff: 4, type: "ID", text: "Nature de : <span class='red-word'>Quiconque</span> parle sera puni.", options: ["Pronom Relatif Ind√©fini", "Adj Ind√©fini", "Nom"], answer: "Pronom Relatif Ind√©fini", reason: "Signifie 'Toute personne qui'." },
        { diff: 4, type: "QCM", text: "C'est <span class='red-word'>___</span> plus belle.", options: ["la", "le", "les", "une"], answer: "la", reason: "Superlatif absolu." },
        { diff: 4, type: "QCM", text: "C'est la femme <span class='red-word'>___</span> je pense.", options: ["√† laquelle", "auquel", "√† qui", "dont"], answer: "√† laquelle", reason: "Penser √Ä + Femme." },
        { diff: 4, type: "QCM", text: "Le chien <span class='red-word'>___</span> la patte est cass√©e.", options: ["dont", "que", "qui", "o√π"], answer: "dont", reason: "La patte DU chien (De -> Dont)." },
        { diff: 4, type: "VF", text: "On dit 'Au <span class='red-word'>fur</span> et √† mesure'.", answer: "Vrai", reason: "Expression fig√©e." },
        { diff: 4, type: "QCM", text: "Il n'y a <span class='red-word'>___</span> probl√®me.", options: ["nul", "nuls", "nulle", "aucuns"], answer: "nul", reason: "Nul remplace Aucun (Soutenu)." },
        { diff: 4, type: "QCM", text: "J'ai achet√© de <span class='red-word'>___</span> orgues.", options: ["belles", "beaux", "bel", "belle"], answer: "belles", reason: "Orgue est masculin singulier, mais F√âMININ pluriel." },
        { diff: 4, type: "QCM", text: "C'est un <span class='red-word'>___</span> d√©lice.", options: ["vrai", "vraie", "vrais", "vraies"], answer: "vrai", reason: "D√©lice : Masc Sing." },
        { diff: 4, type: "QCM", text: "Ce sont de <span class='red-word'>___</span> d√©lices.", options: ["vraies", "vrais", "vraie", "vrai"], answer: "vraies", reason: "D√©lice : Fem Plur (Litt√©raire)." },
        { diff: 4, type: "QCM", text: "Je leur <span class='red-word'>___</span> ai donn√©.", options: ["en", "y", "le", "les"], answer: "en", reason: "Donner DE cela -> En." },
        { diff: 4, type: "QCM", text: "Il y a <span class='red-word'>___</span> de monde.", options: ["peu", "petit", "le peu", "un peu"], answer: "peu", reason: "Adverbe de quantit√©." },
        { diff: 4, type: "VF", text: "'Autrui' est un pronom ind√©fini.", answer: "Vrai", reason: "Signifie 'les autres'." }
    ];

    /* ================= MOTEUR DU JEU ================= */
    
    let currentLevel = 1;
    let currentScore = 0;
    let questionsForLevel = [];
    let questionIndex = 0;
    let levelScore = 0;

    function initGame() {
        currentLevel = 1;
        currentScore = 0;
        startLevel(1);
    }

    function updateTheme(lvl) {
        const root = document.documentElement;
        let color, themeName;

        if (lvl <= 3) { // 1-3: Easy (Green)
            color = "#27ae60"; 
            themeName = "D√©butant";
        } else if (lvl <= 6) { // 4-6: Medium (Orange)
            color = "#d35400"; 
            themeName = "Interm√©diaire";
        } else if (lvl <= 9) { // 7-9: Hard (Red)
            color = "#c0392b"; 
            themeName = "Expert";
        } else { // 10: Boss (Purple/Dark)
            color = "#8e44ad"; 
            themeName = "BOSS FINAL";
        }

        root.style.setProperty('--theme-color', color);
        // On pourrait aussi changer le texte du niveau pour inclure le nom
        // document.getElementById('level-display').textContent = `Niveau ${lvl} (${themeName})`;
    }

    function startLevel(lvl) {
        currentLevel = lvl;
        questionIndex = 0;
        levelScore = 0;
        
        updateTheme(lvl); // Changer la couleur

        let pool = [];

        // Logique de s√©lection des questions
        if (lvl <= 3) {
            pool = questionsDB.filter(q => q.diff === 1);
        } else if (lvl <= 6) {
            pool = questionsDB.filter(q => q.diff === 2);
        } else if (lvl <= 9) {
            pool = questionsDB.filter(q => q.diff === 3);
        } else if (lvl === 10) {
            pool = questionsDB.filter(q => q.diff === 4);
        }

        // M√©langer
        const shuffled = shuffleArray([...pool]);

        // Pour le niveau 10, on prend tout (40 questions). Pour les autres, 10 questions.
        if (lvl === 10) {
            questionsForLevel = shuffled;
        } else {
            // S'assurer qu'il y a assez de questions
            questionsForLevel = shuffled.slice(0, 10);
            while (questionsForLevel.length < 10 && pool.length > 0) {
                questionsForLevel = questionsForLevel.concat(pool).slice(0, 10);
            }
        }

        updateUI();
        loadQuestion();
    }

    function loadQuestion() {
        document.getElementById('feedback-overlay').classList.remove('active');
        document.getElementById('level-overlay').classList.remove('active');

        // Condition de fin de niveau
        const maxQ = (currentLevel === 10) ? questionsForLevel.length : 10;

        if (questionIndex >= maxQ) {
            endLevel();
            return;
        }

        const q = questionsForLevel[questionIndex];
        
        // UI
        document.getElementById('q-type').textContent = getTypeName(q.type);
        document.getElementById('q-text').innerHTML = q.text; // innerHTML pour le rouge
        
        const container = document.getElementById('options-container');
        container.innerHTML = '';

        let options = [];
        if (q.type === 'VF') {
            options = ["Vrai", "Faux"];
            container.style.gridTemplateColumns = "1fr 1fr";
        } else {
            options = q.type === 'ID' ? q.options : shuffleArray([...q.options]);
            if(window.innerWidth < 600 || options.some(o => o.length > 15)) {
                container.style.gridTemplateColumns = "1fr";
            } else {
                container.style.gridTemplateColumns = "1fr 1fr";
            }
        }

        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'btn-option';
            btn.textContent = opt;
            btn.onclick = () => checkAnswer(opt, q);
            container.appendChild(btn);
        });

        // Barre de progression
        let pct = ((questionIndex) / maxQ) * 100;
        document.getElementById('progress').style.width = pct + '%';
    }

    function checkAnswer(selected, q) {
        const isCorrect = (selected === q.answer);
        const fbOverlay = document.getElementById('feedback-overlay');
        
        if (isCorrect) {
            levelScore++;
            currentScore += (currentLevel === 10 ? 20 : 10); // Bonus pour le niveau 10
            
            document.getElementById('fb-icon').textContent = "üåü";
            document.getElementById('fb-title').textContent = "Excellent !";
            document.getElementById('fb-title').className = "big-title correct-txt";
            document.getElementById('fb-msg').innerHTML = `<span style="color:#27ae60; font-weight:bold;">Bonne r√©ponse !</span><br>${q.reason}`;
        } else {
            document.getElementById('fb-icon').textContent = "‚ùå";
            document.getElementById('fb-title').textContent = "Erreur...";
            document.getElementById('fb-title').className = "big-title wrong-txt";
            document.getElementById('fb-msg').innerHTML = `La r√©ponse √©tait : <b>${q.answer}</b>.<br><br>üëâ ${q.reason}`;
        }

        updateUI();
        fbOverlay.classList.add('active');
    }

    function nextQuestion() {
        questionIndex++;
        loadQuestion();
    }

    function endLevel() {
        const lvlOverlay = document.getElementById('level-overlay');
        const title = document.getElementById('lvl-title');
        const msg = document.getElementById('lvl-msg');
        const btn = document.getElementById('lvl-btn');

        // Conditions de r√©ussite
        const maxQ = (currentLevel === 10) ? questionsForLevel.length : 10;
        // Niveau 10 : il faut 30/40 pour gagner. Autres : 7/10.
        const threshold = (currentLevel === 10) ? 30 : 7; 

        if (levelScore >= threshold) {
            if(currentLevel === 10) {
                // VICTOIRE FINALE
                title.textContent = `üèÜ L√âGENDE DU FRAN√áAIS ! üèÜ`;
                title.className = "big-title correct-txt";
                msg.innerHTML = `Incroyable ! Vous avez termin√© le niveau Boss avec <b>${levelScore}/${maxQ}</b>.<br>Vous ma√Ætrisez les d√©terminants √† la perfection !`;
                btn.textContent = "Recommencer le Jeu";
                btn.className = "btn-next";
                btn.onclick = () => initGame();
            } else {
                title.textContent = `Niveau ${currentLevel} R√©ussi ! üéâ`;
                title.className = "big-title correct-txt";
                msg.innerHTML = `Bravo ! Score : <b>${levelScore}/${maxQ}</b>.<br>Pr√™t pour la suite ?`;
                btn.textContent = "Niveau Suivant ‚û°";
                btn.className = "btn-next";
                btn.onclick = () => startLevel(currentLevel + 1);
            }
        } else {
            title.textContent = `Niveau √âchou√© üò¢`;
            title.className = "big-title wrong-txt";
            msg.innerHTML = `Score : <b>${levelScore}/${maxQ}</b>.<br>Il faut ${threshold}/${maxQ} pour passer.`;
            btn.textContent = "R√©essayer ‚Ü∫";
            btn.className = "btn-next btn-retry";
            btn.onclick = () => startLevel(currentLevel);
        }

        lvlOverlay.classList.add('active');
    }

    function getTypeName(type) {
        if(type === 'QCM') return "Compl√©tez la phrase";
        if(type === 'VF') return "Vrai ou Faux ?";
        if(type === 'ID') return "Identifiez la nature";
        return "Question";
    }

    function updateUI() {
        document.getElementById('score-display').textContent = `Score Total: ${currentScore}`;
        let lvlText = `Niveau ${currentLevel}/10`;
        if(currentLevel === 10) lvlText = "Niveau 10 : BOSS FINAL";
        document.getElementById('level-display').textContent = lvlText;
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // Lancer le jeu
    initGame();

</script>

</body>
</html>